angular.module("App",["ngRoute","ngAnimate","ui.bootstrap","ngFileUpload","angularMoment"]),angular.module("App").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home"}).when("/home",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home",resolve:{someting:["DataService",function(a){return a.getData()}],bleh:["TemplateService",function(a){return a.createPhotoArray()}],stuff:["TemplateService",function(a){return a.getTemplates()}],meh:["TemplateService",function(a){return a.getSigArray()}],huh:["TemplateService",function(a){return a.getHeadersArray()}]}}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"settings",resolve:{getTemplates:["TemplateService",function(a){return a.getTemplates()}]}}).when("/gettingdata",{templateUrl:"/views/gettingdata.html",controller:"GettingDataController",controllerAs:"getting"}).when("/donor",{templateUrl:"/views/donor.html",controller:"MainController",controllerAs:"main"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("App").controller("MainController",["$http","$location","DonationService","RouteService",function(a,b,c,d){var e=this;e.message="CTI Thank You Email System",e.homeRoute=function(){d.homeRoute()},e.settingsRoute=function(){d.settingsRoute()},e.sendMail=function(){EmailService.sendMail()},e.overiew=function(){c.getDonorDbStuff().then(function(a){},function(a){})},e.saveTest=function(){var a={};a.opportunityId="006d000000r6ehSAAQ",a.contactId="003d0000037X61sAAC",a.accountId="001d0000025MImRAAW",a.closeDate="2016-08-22",a.sentDate="",a.householdId="a00d000000mOdn5AAC",a.paragraph1="paragraph 1 bleh bleh belh",a.paragraph2="paragraph 2 test",a.paragraph3="paragraph 3 words",a.paragraph4="paragraph 4 more words",a.paragraph5="paragraph 5, doubt it",a.quote="some witty quote",a.picture1="/path/to/pic1",a.picture2="/path/to/pic2",a.picture3="/path/to/pic3",a.picture4="/path/to/pic4",a.letterhead="/path/to/letterhead",a.signature="/path/to/signature",a.template="./emails/template#OverView",c.saveToDb(a).then(function(a){},function(a){console.log("test save fail",a)})},e.isActive=function(a){return a===b.path()}}]),angular.module("App").factory("DataService",["$http","$location",function(a,b){function c(){return a.get("/salesforce/data").then(d,e)}function d(a){s=a.data,g(s),f()}function e(a){}function f(){for(var a=0;a<u.sorted.length;a++){var b=u.sorted[a].CloseDate.split("-");u.sorted[a].date=b[1]+"-"+b[2]+"-"+b[0]}}function g(a){for(var b=0;b<a[0].length;b++)t.push(a[0][b]);h(),i()}function h(){for(var a=0;a<t.length;a++)for(var b=0;b<s[1].length;b++)if(t[a].Primary_Contact__c==s[1][b].Id){t[a].householdId=s[1][b].npo02__Household__c;break}}function i(){for(var a=0;a<t.length;a++)t[a].email=j(t[a]),t[a].address=k(t[a]),t[a].formalGreeting=l(t[a]),t[a].informalGreeting=m(t[a]),t[a].personName=n(t[a]),t[a].phone=o(t[a]),t[a].donationHistory=p(t[a]),t[a].firstName=q(t[a]),t[a].lastName=r(t[a])}function j(a){for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id&&null!=s[3][b].npo02__HouseholdEmail__c)return s[3][b].npo02__HouseholdEmail__c;for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].Email)return s[1][b].Email;for(var b=0;b<s[2].length;b++)if(a.AccountId==s[2][b].Id&&null!=s[2][b].Organization_Email__c)return s[2][b].Organization_Email__c;return"no email found"}function k(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].MailingAddress)return s[1][b].MailingAddress;for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id&&null!=s[3][b].npo02__Formula_MailingAddress__c)return s[3][b].npo02__Formula_MailingAddress__c}else for(var b=0;b<s[2].length;b++)if(a.AccountId==s[2][b].Id&&null!=s[2][b].BillingAddress)return s[2][b].BillingAddress;return"no address found"}function l(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id&&null!=s[3][b].npo02__Formal_Greeting__c)return s[3][b].npo02__Formal_Greeting__c;for(var b=0;b<s[1].length;b++){if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].name&&null!=s[1][b].Saluation)return s[1][b].Saluation+s[1][b].Name;if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].name)return s[1][b].Name}}else{for(var b=0;b<s[1].length;b++){if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].Name&&null!=s[1][b].Saluation)return s[1][b].Saluation+s[1][b].Name;if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].Name)return s[1][b].Name}for(var b=0;b<s[2].length;b++){if(a.AccountId==s[2][b].Id&&null!=s[2][b].Name&&null!=s[2][b].Formal_Salutation__c)return s[2][b].Formal_Salutation__c+s[2][b].Name;if(a.AccountId==s[2][b].Id&&null!=s[2][b].Name)return s[2][b].Name}}return"no Formal Greeting found"}function m(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id&&null!=s[3][b].npo02__Informal_Greeting__c)return s[3][b].npo02__Informal_Greeting__c;for(var b=0;b<s[2].length;b++)if(a.AccountId==s[2][b].Id&&null!=s[2][b].Informal_Greeting__c)return s[2][b].Informal_Greeting__c;for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][1].Greeting__c)return s[2][b].Greeting__c}else{for(var b=0;b<s[2].length;b++)if(a.AccountId==s[2][b].Id&&null!=s[2][b].Informal_Greeting__c)return s[2][b].Informal_Greeting__c;for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id&&null!=s[1][b].Greeting__c)return s[1][b].Greeting__c}return"no informal Greeting found"}function n(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id)return s[3][b].Name;for(var c=0;c<s[1].length;c++)if(a.Primary_Contact__c==s[1][c].Id)return s[1][c].Name}else{for(var c=0;c<s[1].length;c++)if(a.Primary_Contact__c==s[1][c].Id)return s[1][c].Name;for(var d=0;d<s[2].length;d++)if(a.AccountId==s[2][d].Id)return s[2][d].Name}return"No Name Found"}function o(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<s[3].length;b++)if(a.householdId==s[3][b].Id){if(null!==s[3][b].npo02__HouseholdPhone__c)return s[3][b].npo02__HouseholdPhone__c;break}for(var c=0;c<s[1].length;c++)if(a.Primary_Contact__c==s[1][c].Id){if(null!==s[1][c].Phone)return s[1][c].Phone;break}}else{for(var d=0;d<s[2].length;d++)if(a.AccountId==s[2][d].Id){if(null!==s[2][d].Phone)return s[2][d].Phone;break}for(var e=0;e<s[1].length;e++)if(a.Primary_Contact__c==s[1][e].Id)return null!==s[1][e].Phone?s[1][e].Phone:"No phone number found"}return"No phone number found"}function p(a){for(var b=0;b<s[2].length;b++){var c={};if(a.AccountId==s[2][b].Id&&null!=s[2][b].BillingAddress)return c.lifeTimeAmount=s[2][b].npe01__LifetimeDonationHistory_Amount__c,c.lifeTimeNumber=s[2][b].npe01__LifetimeDonationHistory_Number__c,c}return"No donation history found"}function q(a){for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id){var c=s[1][b].Name.split(" ");return c[0]}}function r(a){for(var b=0;b<s[1].length;b++)if(a.Primary_Contact__c==s[1][b].Id){var c=s[1][b].Name.split(" ");return c[1]}}var s=[],t=[],u={},v={donors:[{AccountId:"001d000000K2KKAAA3",Amount:200,CloseDate:"2016-08-31",Id:"006d000000r6cKWAAY",Name:"Test",Primary_Contact__c:"003d000000V8J9gAAF",address:{city:"Monrovia",country:"Liberia",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:null,state:null,stateCode:null,street:"N&N Corporation"},date:"08-31-2016",donationHistory:{lifeTimeAmount:635,lifeTimeNumber:2},email:"ctithankyou@outlook.com",firstName:"Christian",formalGreeting:"Christian Neufville",householdId:"a00d0000007j6fAAAQ",informalGreeting:"Christian",lastName:"Neufville",npe01__Contact_Id_for_Role__c:"003d000000V8J9gAAF",npe01__Is_Opp_From_Individual__c:"true",personName:"Neufville Household",phone:"No phone number found"},{AccountId:"001d0000025MIlJAAW",Amount:300,CloseDate:"2016-09-02",Id:"006d000000r6efMAAQ",Name:"Tony Test 09/02/16",Primary_Contact__c:"003d0000037X5z3AAC",address:{city:"Notreal",country:"US",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:"55444",state:"MT",stateCode:null,street:"123 fake st."},date:"09-02-2016",donationHistory:{lifeTimeAmount:1100,lifeTimeNumber:8},email:"tdjohnson0722@gmail.com",firstName:"Tony",formalGreeting:"Mr. Tony Johnson",householdId:"a00d000000mOdmgAAC",informalGreeting:"Tony",lastName:"Johnson",npe01__Contact_Id_for_Role__c:"003d0000037X5z3AAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Johnson Household",phone:"(555) 555-3333"},{AccountId:"001d0000025MImRAAW",Amount:2e3,CloseDate:"2016-09-01",Id:"006d000000r6ehSAAQ",Name:"Mary Wilson- Donation 9/01/2016",Primary_Contact__c:"003d0000037X61sAAC",address:{city:"real",country:null,countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:55707,state:"MN",stateCode:null,street:"74382 idk ave"},date:"09-01-2016",donationHistory:{lifeTimeAmount:11110,lifeTimeNumber:2},email:"ctithankyou@outlook.com",firstName:"Mary",formalGreeting:"Mrs. Maria",householdId:"a00d000000mOdn5AAC",informalGreeting:"Mary",lastName:"Wilson",npe01__Contact_Id_for_Role__c:"003d0000037X61sAAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Wilson Household",phone:"(651) 444-4444"},{AccountId:"001d0004 00K2KKAAAu",Amount:550,CloseDate:"2016-09-05",Id:"006d000000r6cKWMAY",Name:"Test",Primary_Contact__c:"003d000000V8J9gAAF",address:{city:"Minneapolis",country:"United States",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:"55104",state:"MN",stateCode:null,street:"Main St."},date:"09-05-2016",donationHistory:{lifeTimeAmount:900,lifeTimeNumber:3},email:"ctithankyou@outlook.com",firstName:"Sandy",formalGreeting:"Sandy Carlile",householdId:"a00d0000007j6fAAAQ",informalGreeting:"Sandy",lastName:"Carlile",npe01__Contact_Id_for_Role__c:"003d000000V8J9gAAF",npe01__Is_Opp_From_Individual__c:"true",personName:"Carlile Household",phone:"(651)-555-5555"},{AccountId:"001d000000K2KKBAN6",Amount:75,CloseDate:"2016-09-04",Id:"006d000000r6cKWMA1",Name:"Test",Primary_Contact__c:"003d000000V8J9gAAF",address:{city:"St. Paul",country:"United States",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:"55112",state:"MN",stateCode:null,street:"Jackson St."},date:"09-04-2016",donationHistory:{lifeTimeAmount:75,lifeTimeNumber:1},email:"ctithankyou@outlook.com",firstName:"Hannah",formalGreeting:"Hannah Samsonite",householdId:"a00d0000007j6fAAAQ",informalGreeting:"Hannah",lastName:"Samsonite",npe01__Contact_Id_for_Role__c:"003d000000V8J9gAAF",npe01__Is_Opp_From_Individual__c:"true",personName:"Samsonite Household",phone:"No phone number found"}]};return u.sorted=t,{preconvertDates:f,sortedObject:u,getData:c,donorObject:v}}]),angular.module("App").controller("LoginController",["$http","$location","RouteService","DataService",function(a,b,c,d){function e(a){console.log("Success",a),b.path("/home")}function f(a){console.log("Failure",a),b.path("/"),g.error=!0}var g=this;g.homeRoute=function(){c.homeRoute()},g.editRoute=function(){c.editRoute()},g.settingsRoute=function(){c.settingsRoute()},g.username="",g.password="",g.error=!1,g.errorMessage="Sorry, Wrong Username/Password",g.login=function(){console.log("Username",g.username),console.log("Password",g.password);var b={};b.username=g.username,b.password=g.password,a.post("/login",b).then(e,f)}}]),angular.module("App").controller("GettingDataController",["DataService","TemplateService",function(a,b){a.getData(),b.getTemplates()}]),angular.module("App").controller("HomeController",["$http","$location","DataService","RouteService","orderByFilter","$uibModal","TemplateService","EmailService","UserService","$route","DonationService",function(a,b,c,d,e,f,g,h,i,j,k){function l(){for(var a=c.donorObject.donors,b=0;b<a.length;b++)a[b].template1=Object.assign({},g.templatesObject.template1),a[b].template2=Object.assign({},g.templatesObject.template2),a[b].template3=Object.assign({},g.templatesObject.template3),a[b].template4=Object.assign({},g.templatesObject.template4),a[b].template5=Object.assign({},g.templatesObject.template5),a[b].templateNum=p.standardTemplate;p.donorList=a}function m(a){p.selectedTemplate=p.templates[a-1]}function n(a){g.updateCurrentDonor(a)}function o(a){var b=p.donorList.indexOf(a);p.donorList.splice(b,1),p.currentDonor=void 0,p.messageSent=!0}var p=this;p.donorList=[],p.currentDonor,p.editedEmails={},p.messageSent=!1,p.standardTemplate=i.standardTemplate.template,g.bleh(),p.homeRoute=function(){d.homeRoute()},p.editRoute=function(){d.editRoute()},p.settingsRoute=function(){d.settingsRoute()},p.templatesObject=g.templatesObject,p.currentTemplate=g.currentTemplate,p.savedEmails=g.savedEmails,p.imagesArray=g.imagesObject.images,p.fieldId="",p.setCurrentEditView=function(a){var b;if(p.currentDonor){for(var c=0;c<p.donorList.length;c++)p.donorList[c].Id==p.currentDonor.Id&&(b=c);p.donorList[b]=p.currentDonor}var d=a.templateNum;n(a),p.currentDonor=a,m(a["template"+d].temp),p.setTemplateHighlight(d)},p.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"},{name:"Template 4",url:"emails/template4EditView.html"},{name:"Template 5",url:"emails/template5EditView.html"}],p.selectedTemplate=p.templates[0],p.setCurrentTemplate=function(a){m(a),p.currentDonor.templateNum=a},p.editModal=function(a,b){p.fieldId=a,p.currentDonor["template"+b].currentField=a,g.updateCurrentDonorTemplate(b),f.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},p.imageModal=function(a,b){p.currentDonor["template"+b].currentField=a,g.updateCurrentDonorTemplate(b),f.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md",windowClass:"imageModalClass"})},p.propertyName="Amount",p.reverse=!0,p.donors=p.donorList,p.dropDownName="Donation",p.sortBy=function(a){switch(p.reverse=p.propertyName===a&&!p.reverse,p.propertyName=a,a){case"lastName":p.dropDownName="Name";break;case"Amount":p.dropDownName="Donation";break;case"date":p.dropDownName="Date"}},p.sendMail=function(a){var b=a.templateNum;h.sendMail(a,b),k.saveEmail(a,b),o(a)},p.sendAll=function(){swal({title:"Are you sure?",text:"Do You Want to Send Messages With current formats?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Send Messages",closeOnConfirm:!1},function(){for(var a=0;a<p.donorList.length;a++){var b=p.donorList[a].templateNum;h.sendMail(p.donorList[a],b),k.saveEmail(p.donorList[a],b),p.messageSent=!0}p.currentDonor=void 0,p.donorList=[],swal("Sent!","Your Messages Have Been Sent","success")})},p.isActive=function(a){if(p.currentDonor)return a===p.currentDonor.Id},p.templateHighlight={template1:"orange-highlight",template2:"",template3:"",template4:"",template5:""},p.setTemplateHighlight=function(a){p.templateHighlight.template1="",p.templateHighlight.template2="",p.templateHighlight.template3="",p.templateHighlight.template4="",p.templateHighlight.template5="",p.templateHighlight["template"+a]="orange-highlight"},l()}]),angular.module("App").controller("EditController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){function g(a){e.getCurrentTemplate(a)}var h=this;h.templatesObject=e.templatesObject,h.currentTemplate=e.currentTemplate,h.savedEmails=e.savedEmails,h.imagesArray=e.imagesObject.images,h.fieldId="",h.editObject={},h.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"}],h.template=h.templates[0],h.editModal=function(a){h.fieldId=a,h.currentTemplate.currentField=a,c.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.imageModal=function(a){c.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.sendMail=function(a,b,c){f.sendMail(a,b,c)},h.saveEditedEmail=function(a,b,c,d,f,g){e.saveEditedEmail(a,b,c,d,f,g)},g(1)}]),angular.module("App").controller("SettingsController",["$http","$location","DataService","UserService","Upload","$timeout","$uibModal","SettingsService","TemplateService",function(a,b,c,d,e,f,g,h,i){function j(a){l()}function k(a){console.log("Failed to delete",a),l()}function l(){a.get("photos/createphotoarray").then(m)}function m(a){u.photos=a.data,i.imagesObject.images=a.data}function n(){a.get("photos/createsignaturearray").then(o)}function o(a){u.signatures=a.data,i.data.signatures=u.signatures}function p(){a.get("photos/createheaderarray").then(q)}function q(a){u.headers=a.data,i.data.headers=u.headers}function r(){var a=i.templatesObject;u.templatesList=Object.assign({},a)}function s(){u.currentTemplate=h.currentTemplate.template[0].template}function t(){h.currentTemplate.template[0].template=u.templatesList.template1}var u=this;i.bleh(),u.unhidePhotos=!1,u.unhideSignatures=!1,u.unhideHeaders=!1,u.templateSaved=!1,u.deletePhoto=function(b){swal({title:"Are you sure?",text:"You will not be able to recover this image!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){swal("Deleted!","Your image has been deleted.","success"),deletePhoto={},id=12345,deletePhoto.id=b.id,a.post("/photos/deletePhoto",deletePhoto).then(j,k)})},l(),n(),p(),u.photos=d.photosArray,u.signatures=d.signaturesArray,u.headers=d.headersArray,u.uploadPic=function(a){a.upload=e.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data,l()})},function(a){a.status>0&&(u.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},u.uploadSig=function(a){a.upload=e.upload({url:"/photos/sigfile",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data}),200==b.status&&n()},function(a){a.status>0&&(u.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},u.uploadHeader=function(a){a.upload=e.upload({url:"/photos/headers",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data}),200==b.status&&p()},function(a){a.status>0&&(u.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},u.settingsClick=function(a){u.showSettings.photo=!1,u.showSettings.template=!1,u.showSettings.signature=!1,u.showSettings.header=!1,u.showSettings[a]=!0,u.menuHighlight.photo="",u.menuHighlight.template="",u.menuHighlight.signature="",u.menuHighlight.header="",u.menuHighlight[a]="menu-highlight"},u.showSettings={photo:!0,template:!1,signature:!1,header:!1},u.menuHighlight={photo:"menu-highlight",template:"",signature:"",header:""},u.templatesList,u.currentTemplate=h.currentTemplate.template[0].template,u.fieldId="",u.editModal=function(a){u.fieldId=a,u.currentTemplate.currentField=a,g.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_settings_modal.html",controller:"SettingsModalController",controllerAs:"settingsModal",size:"md"})},u.imageModal=function(a){u.fieldId=a,u.currentTemplate.currentField=a,g.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_settings_modal.html",controller:"SettingsModalController",controllerAs:"settingsModal",size:"md",windowClass:"imageModalClass"})},u.templates=[{name:"Template 1",url:"emails/template1SettingsView.html"},{name:"Template 2",url:"emails/template2SettingsView.html"},{name:"Template 3",url:"emails/template3SettingsView.html"},{name:"Template 4",url:"emails/template4SettingsView.html"},{name:"Template 5",url:"emails/template5SettingsView.html"}],u.selectedTemplate=u.templates[0],u.setCurrentTemplate=function(a){u.selectedTemplate=u.templates[a-1],h.currentTemplate.template[0].template=u.templatesList["template"+a],s(),u.templateSaved=!1},u.saveAllTemplates=function(){},u.templateHighlight={template1:"orange-highlight",template2:"",template3:"",template4:"",template5:""},u.setTemplateHighlight=function(a){u.templateHighlight.template1="",u.templateHighlight.template2="",u.templateHighlight.template3="",u.templateHighlight.template4="",u.templateHighlight.template5="",u.templateHighlight["template"+a]="orange-highlight"},u.saveTemplate=function(a){i.saveTemplate(a),u.templateSaved=!0},u.isActive=function(a){return a===b.path()},r(),t(),s()}]),angular.module("App").factory("RouteService",["$location",function(a){function b(){a.path("/")}function c(){a.path("/home")}function d(){a.path("/edit")}function e(){a.path("/settings")}return{loginRoute:b,homeRoute:c,editRoute:d,settingsRoute:e}}]),angular.module("App").factory("EmailService",["$http","$location",function(a,b){function c(c,d){var e={};e.p1=c["template"+d].p1,e.p2=c["template"+d].p2,e.p3=c["template"+d].p3,e.p4=c["template"+d].p4,e.q=c["template"+d].quote,e.ps=c["template"+d].ps,1==c.templateNum&&(e.img=c.template1.img.id,e.header=c.template1.header.id,e.sig=c.template1.sig.id),2==c.templateNum&&(e.img=c.template2.img.id,e.header=c.template2.header.id,e.sig=c.template2.sig.id),3==c.templateNum&&(e.img=c.template3.img.id,e.img2=c.template3.img2.id,e.header=c.template3.header.id,e.sig=c.template3.sig.id),4==c.templateNum&&(e.img=c.template4.img.id,e.img2=c.template4.img2.id,e.img3=c.template4.img3.id,e.img4=c.template4.img4.id,e.header=c.template4.header.id,e.sig=c.template4.sig.id),5==c.templateNum&&(e.img=c.template5.img.id,e.img2=c.template5.img2.id,e.img3=c.template5.img3.id,e.img4=c.template5.img4.id,e.header=c.template5.header.id,e.sig=c.template5.sig.id),e.template=c["template"+d].temp,e.senderName=c["template"+d].senderName,e.senderTitle=c["template"+d].senderTitle,e.email=c.email,e.firstName=c.firstName,e.amount=c.Amount,e.date=c.date,a.post("/email/sendMail",e).then(function(a){}),b.path("/home")}return{sendMail:c}}]),angular.module("App").factory("TemplateService",["$location","Upload","$timeout","$http","DataService",function(a,b,c,d,e){function f(a){var b={};return b.id=a._id,b.p1=a.p1,b.p2=a.p2,b.p3=a.p3,b.p4=a.p4,b.quote=a.quote,b.ps=a.ps,b.header=a.header,b.sig=a.sig,null!=a.img|""!=a.img&&(b.img="photos/getDbImages/"+a.img.id),null!=a.img2|""!=a.img2&&(b.img2="photos/getDbImages/"+a.img2.id),null!=a.img3|""!=a.img3&&(b.img3="photos/getDbImages/"+a.img3.id),null!=a.img4|""!=a.img4&&(b.img4="photos/getDbImages/"+a.img4.id),null!=a.sig|""!=a.sig&&(b.sig="photos/createsignaturearray/"+a.sig.id),null!=a.header|""!=a.header&&(b.header="photos/createheaderarray/"+a.header.id),b.template=a.temp,b.senderTitle=a.senderTitle,b.senderName=a.senderName,d.post("/template/saveTemplate",b).then(g,h)}function g(a){}function h(a){console.log("save temp failure",a)}function l(a){H.donor[0].donor.img=a}function p(a,b,c){H.donor[0].donor["template"+c][a]=b}function q(a){H.donor[0].donor=a}function r(a){return E.currentTemplate={},E.currentTemplate=H.donor[0].donor["template"+a],E.currentTemplate}function s(){return E.currentTemplate}function t(){return d.get("photos/createphotoarray").then(u)}function u(a){J.images=a.data}function v(){var a={},b={},c={};for(a.t1={},a.t2={},a.t3={},a.t4={},a.t5={},a.t1.img=F.template1.img.split("/"),a.t2.img=F.template2.img.split("/"),a.t3.img=F.template3.img.split("/"),a.t3.img2=F.template3.img2.split("/"),a.t4.img=F.template4.img.split("/"),a.t4.img2=F.template4.img2.split("/"),a.t4.img3=F.template4.img3.split("/"),a.t4.img4=F.template4.img4.split("/"),a.t5.img=F.template5.img.split("/"),a.t5.img2=F.template5.img2.split("/"),a.t5.img3=F.template5.img3.split("/"),a.t5.img4=F.template5.img4.split("/"),b.sig1=F.template1.sig.split("/"),c.header1=F.template1.header.split("/"),b.sig2=F.template2.sig.split("/"),c.header2=F.template2.header.split("/"),b.sig3=F.template3.sig.split("/"),c.header3=F.template3.header.split("/"),b.sig4=F.template4.sig.split("/"),c.header4=F.template4.header.split("/"),b.sig5=F.template5.sig.split("/"),c.header5=F.template5.header.split("/"),i=0;i<J.images.length;i++)if(a.t1.img[2]==J.images[i].id){F.template1.img=J.images[i];break}for(j=0;j<J.images.length;j++)a.t2.img[2]==J.images[j].id&&(F.template2.img=J.images[j]);for(k=0;k<J.images.length;k++)a.t3.img[2]==J.images[k].id&&(F.template3.img=J.images[k]),a.t3.img2[2]==J.images[k].id&&(F.template3.img2=J.images[k]);for(m=0;m<J.images.length;m++)a.t4.img[2]==J.images[m].id&&(F.template4.img=J.images[m]),a.t4.img2[2]==J.images[m].id&&(F.template4.img2=J.images[m]),a.t4.img3[2]==J.images[m].id&&(F.template4.img3=J.images[m]),a.t4.img4[2]==J.images[m].id&&(F.template4.img4=J.images[m]),a.t5.img[2]==J.images[m].id&&(F.template5.img=J.images[m]),a.t5.img2[2]==J.images[m].id&&(F.template5.img2=J.images[m]),a.t5.img3[2]==J.images[m].id&&(F.template5.img3=J.images[m]),a.t5.img4[2]==J.images[m].id&&(F.template5.img4=J.images[m]);for(n=0;n<5;n++)b.sig1[2]==E.signatures[0].id&&(F.template1.sig=E.signatures[0]),b.sig2[2]==E.signatures[0].id&&(F.template2.sig=E.signatures[0]),b.sig3[2]==E.signatures[0].id&&(F.template3.sig=E.signatures[0]),b.sig4[2]==E.signatures[0].id&&(F.template4.sig=E.signatures[0]),b.sig5[2]==E.signatures[0].id&&(F.template5.sig=E.signatures[0]);for(o=0;o<5;o++)c.header1[2]==E.headers[0].id&&(F.template1.header=E.headers[0]),c.header2[2]==E.headers[0].id&&(F.template2.header=E.headers[0]),c.header3[2]==E.headers[0].id&&(F.template3.header=E.headers[0]),c.header4[2]==E.headers[0].id&&(F.template4.header=E.headers[0]),c.header5[2]==E.headers[0].id&&(F.template5.header=E.headers[0])}function w(a){a.upload=b.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){c(function(){a.result=b.data,t()})},function(a){a.status>0&&(G.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})}function x(){return d.get("/template/getTemplates").then(y,z)}function y(a){K=a.data,F.template1=Object.assign({},K[0]),F.template2=Object.assign({},K[1]),F.template3=Object.assign({},K[2]),F.template4=Object.assign({},K[3]),F.template5=Object.assign({},K[4])}function z(a){console.log("template retrieval failure")}function A(a,b,c,d,e,f){I.emails.push({p1:a,p2:b,p3:c,p4:d,quote:e,ps:f})}function B(){return d.get("/photos/createsignaturearray").then(function(a){E.signatures=a.data},function(a){console.log("err creating sigarray in tempservice",a)})}function C(){return d.get("/photos/createheaderarray").then(function(a){E.headers=a.data},function(a){console.log("err creating headersArray in tempservice",a)})}function D(a,b,c){F["template"+c][a]=b}var E={},F={},G=this;E.signatures={},E.headers={};var H={donor:[{donor:{}}]};E.currentTemplate={key:"bleh"};var I={emails:[]},J={images:[]},K=[];return{currentDonor:H,data:E,imagesObject:J,saveEditedEmail:A,savedEmails:I,setCurrentImg:l,templatesObject:F,uploadPic:w,createPhotoArray:t,updateCurrentDonor:q,updateCurrentDonorKey:p,updateCurrentDonorTemplate:r,bleh:v,getTemplates:x,templatesObject:F,awesome:s,saveTemplate:f,getSigArray:B,getHeadersArray:C,updateCurrentTemplateKey:D}}]),angular.module("App").controller("ModalController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){var g=this;g.currentTemplate=e.awesome(),g.currentDonor=g.currentTemplate,g.currentField=g.currentTemplate.currentField,g.imagesArray=e.imagesObject.images,g.updateCurrentDonorKey=function(a,b){var c=g.currentTemplate.temp;e.updateCurrentDonorKey(a,b,c)}}]),angular.module("App").factory("DonationService",["$http","$location",function(a,b){function c(){return a.get("/donor/sentDonors").then(function(a){p.donors=a.data,d(p)},function(a){console.log("err",a),response.sendStatus(500)})}function d(c){return a.post("/salesforce/overview",c).then(function(a){o=a.data,g(o),b.path("/overview")},function(a){console.log("faiiiiiiiiiiiiilure",a),response.sendStatus(500)})}function e(a,b){var c={};return c.opportunityId=a.Id,c.contactId=a.Primary_Contact__c,c.accountId=a.AccountId,c.closeDate=a.CloseDate,c.sentDate="",c.householdId=a.householdId,c.paragraph1=a["template"+b].p1,c.paragraph2=a["template"+b].p2,c.paragraph3=a["template"+b].p3,c.paragraph4=a["template"+b].p4,c.paragraph5="",c.quote=a["template"+b].quote,null!=a["template"+b].img|""!=a["template"+b].img&&(c.picture1="photos/getDbImages/"+a["template"+b].img.id),null!=a["template"+b].img2|""!=a["template"+b].img2&&(c.picture2="photos/getDbImages/"+a["template"+b].img2.id),null!=a["template"+b].img3|""!=a["template"+b].img3&&(c.picture3="photos/getDbImages/"+a["template"+b].img3.id),null!=a["template"+b].img4|""!=a["template"+b].img4&&(c.picture4="photos/getDbImages/"+a["template"+b].img4.id),c.letterhead="/path/to/letterhead",c.signature="/path/to/signature",c.template=a["template"+b].temp,f(c).then(function(a){},function(a){console.log("test save fail",a)})}function f(b){return a.post("/donor/createData",b).then(function(a){},function(a){console.log("fail saving to db",a)})}function g(a){for(var b=0;b<a.length;b++)q.push(a[b]),q[b].Email=h(q[b],a[b]),q[b].personName=i(q[b],a[b]),q[b].AverageAmount=j(q[b],a[b]),q[b].TotalAmount=k(q[b],a[b]),q[b].TotalNumber=l(q[b],a[b]),q[b].FirstName=m(q[b],a[b]),q[b].LastName=n(q[b],a[b]);return q}function h(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__Household__r.npo02__HouseholdEmail__c)return b.Contact.npo02__Household__r.npo02__HouseholdEmail__c;if(null!=b.Contact.Email)return b.Contact.Email}else{if(null!=b.Contact.Email)return b.Contact.Email;if(null!=donors.Account.Organization_Email__c)return b.Account.Organization_Email__c}return"No Email Found"}function i(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__Household__r.Name)return b.Contact.npo02__Household__r.Name;if(null!=b.Contact.Name)return b.Contact.Name}else{if("true"!=b.npe01__Is_Opp_From_Individual__c||null!=b.Account.Name||null!=b.Contact.Name)return b.Contact.Name+" - "+b.Account.Name;if(null!=b.Contact.Name)return b.Contact.Name;if(null!=b.Account.Name)return b.Account.Name}return"No Name Found"}function j(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__AverageAmount__c)return b.Contact.npo02__AverageAmount__c}else{if(null!=b.Account.npo02__AverageAmount__c)return b.Account.npo02__AverageAmount__c;if(null!=b.Contact.npo02__AverageAmount__c)return b.Contact.npo02__AverageAmount__c}return"No Average Found"}function k(a,b){return null!=b.Account.npe01__LifetimeDonationHistory_Amount__c?b.Account.npe01__LifetimeDonationHistory_Amount__c:"No Lifetime Total Amount Found"}function l(a,b){return null!=b.Account.npe01__LifetimeDonationHistory_Number__c?b.Account.npe01__LifetimeDonationHistory_Number__c:"No Lifetime Total Number Found"}function m(a,b){if(null!=b.Contact.Name){var c=b.Contact.Name.split(" ");return c[0]}return null!=b.Account.Name?b.Account.Name:"No First Name Found"}function n(a,b){if(null!=b.Contact.Name){var c=b.Contact.Name.split(" ");return c[1]}return null!=b.Account.Name?"(Company)":"No Last Name Found"}var o={},p={},q=[];return{getDonorDbStuff:c,getDonorsSentEmailData:d,saveToDb:f,saveEmail:e}}]),angular.module("App").controller("OverviewController",["$http","$location","DonationService","RouteService","orderByFilter","$uibModal","TemplateService","UserService",function(a,b,c,d,e,f,g,h){var i=this;i.donorList=c.donorObject,i.currentDonor,i.sfDonor=c.overview,i.edit=!0,i.homeRoute=function(){
d.homeRoute()},i.editRoute=function(){d.editRoute()},i.settingsRoute=function(){d.settingsRoute()},i.bleh=function(){var b="57c6229c67c3eed5198b9e47";a.post("photos/getDbImages/"+b).then(function(a){},function(a){console.log("err",a)})}}]),angular.module("App").factory("UserService",["$http",function(a){var b={},c={},d={},e={template:1};return{photosArray:b,signaturesArray:c,headersArray:d,standardTemplate:e}}]),angular.module("App").factory("SettingsService",["$location","Upload","$timeout","$http",function(a,b,c,d){var e={template:[{template:{}}]};return{currentTemplate:e}}]),angular.module("App").controller("SettingsModalController",["$http","$location","$uibModal","DataService","TemplateService","EmailService","SettingsService",function(a,b,c,d,e,f,g){var h=this;h.currentTemplate=g.currentTemplate.template[0].template,h.currentField=g.currentTemplate.template[0].template.currentField,h.imagesArray=e.imagesObject.images,h.updateCurrentTemplateKey=function(a,b){var c=h.currentTemplate.temp;e.updateCurrentTemplateKey(a,b,c)}}]);