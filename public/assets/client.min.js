angular.module("App",["ngRoute","ngAnimate","ui.bootstrap","ngFileUpload"]),angular.module("App").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"login"}).when("/home",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home"}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"settings"}).when("/gettingdata",{templateUrl:"/views/gettingdata.html",controller:"GettingDataController",controllerAs:"getting"}).when("/donor",{templateUrl:"/views/donor.html",controller:"MainController",controllerAs:"main"}).when("/overview",{templateUrl:"/views/overview.html",controller:"MainController",controllerAs:"main"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("App").controller("MainController",["$http","$location","DonationService",function(a,b,c){var d=this;d.message="CTI Thank You Email System",d.sendMail=function(){EmailService.sendMail()},d.overiew=function(){c.getDonorDbStuff().then(function(a){console.log("did you work?")},function(a){console.log("worked???")})},d.saveTest=function(){var a={};a.opportunityId="006d000000r6ehSAAQ",a.contactId="003d0000037X61sAAC",a.accountId="001d0000025MImRAAW",a.closeDate="2016-08-22",a.sentDate="",a.householdId="a00d000000mOdn5AAC",a.paragraph1="paragraph 1 bleh bleh belh",a.paragraph2="paragraph 2 test",a.paragraph3="paragraph 3 words",a.paragraph4="paragraph 4 more words",a.paragraph5="paragraph 5, doubt it",a.quote="some witty quote",a.picture1="/path/to/pic1",a.picture2="/path/to/pic2",a.picture3="/path/to/pic3",a.picture4="/path/to/pic4",a.letterhead="/path/to/letterhead",a.signature="/path/to/signature",console.log("test button"),c.saveToDb(a).then(function(a){console.log("test save success",a)},function(a){console.log("test save fail",a)})}}]),angular.module("App").factory("DataService",["$http","$location",function(a,b){function c(){b.path("/home")}function d(){a.get("/salesforce/data").then(e,f)}function e(a){console.log(a),x=a.data,i(x),g(),h(),b.path("/home")}function f(a){console.log("fail",a)}function g(){for(var a=0;a<z.sorted.length;a++){var b=z.sorted[a].CloseDate.split("-");z.sorted[a].date=b[1]+"-"+b[2]+"-"+b[0]}}function h(){for(var a=0;a<z.sorted.length;a++)z.sorted[a].convertedDate=new Date(z.sorted[a].date)}function i(a){for(var b=0;b<a[0].length;b++)y.push(a[0][b]);j(),k()}function j(){for(var a=0;a<y.length;a++)for(var b=0;b<x[1].length;b++)if(y[a].Primary_Contact__c==x[1][b].Id){y[a].householdId=x[1][b].npo02__Household__c;break}}function k(){for(var a=0;a<y.length;a++)y[a].email=l(y[a]),y[a].address=m(y[a]),y[a].formalGreeting=n(y[a]),y[a].informalGreeting=o(y[a]),y[a].personName=p(y[a]),y[a].phone=q(y[a]),y[a].donationHistory=r(y[a]),y[a].firstName=s(y[a]),y[a].lastName=t(y[a]);console.log(y)}function l(a){for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id&&null!=x[3][b].npo02__HouseholdEmail__c)return x[3][b].npo02__HouseholdEmail__c;for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].Email)return x[1][b].Email;for(var b=0;b<x[2].length;b++)if(a.AccountId==x[2][b].Id&&null!=x[2][b].Organization_Email__c)return x[2][b].Organization_Email__c;return"no email found"}function m(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].MailingAddress)return x[1][b].MailingAddress;for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id&&null!=x[3][b].npo02__Formula_MailingAddress__c)return x[3][b].npo02__Formula_MailingAddress__c}else for(var b=0;b<x[2].length;b++)if(a.AccountId==x[2][b].Id&&null!=x[2][b].BillingAddress)return x[2][b].BillingAddress;return"no address found"}function n(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id&&null!=x[3][b].npo02__Formal_Greeting__c)return x[3][b].npo02__Formal_Greeting__c;for(var b=0;b<x[1].length;b++){if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].name&&null!=x[1][b].Saluation)return x[1][b].Saluation+x[1][b].Name;if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].name)return x[1][b].Name}}else{for(var b=0;b<x[1].length;b++){if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].Name&&null!=x[1][b].Saluation)return x[1][b].Saluation+x[1][b].Name;if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].Name)return x[1][b].Name}for(var b=0;b<x[2].length;b++){if(a.AccountId==x[2][b].Id&&null!=x[2][b].Name&&null!=x[2][b].Formal_Salutation__c)return x[2][b].Formal_Salutation__c+x[2][b].Name;if(a.AccountId==x[2][b].Id&&null!=x[2][b].Name)return x[2][b].Name}}return"no Formal Greeting found"}function o(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id&&null!=x[3][b].npo02__Informal_Greeting__c)return x[3][b].npo02__Informal_Greeting__c;for(var b=0;b<x[2].length;b++)if(a.AccountId==x[2][b].Id&&null!=x[2][b].Informal_Greeting__c)return x[2][b].Informal_Greeting__c;for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][1].Greeting__c)return x[2][b].Greeting__c}else{for(var b=0;b<x[2].length;b++)if(a.AccountId==x[2][b].Id&&null!=x[2][b].Informal_Greeting__c)return x[2][b].Informal_Greeting__c;for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id&&null!=x[1][b].Greeting__c)return x[1][b].Greeting__c}return"no informal Greeting found"}function p(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id)return x[3][b].Name;for(var c=0;c<x[1].length;c++)if(a.Primary_Contact__c==x[1][c].Id)return x[1][c].Name}else{for(var c=0;c<x[1].length;c++)if(a.Primary_Contact__c==x[1][c].Id)return x[1][c].Name;for(var d=0;d<x[2].length;d++)if(a.AccountId==x[2][d].Id)return x[2][d].Name}return"No Name Found"}function q(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<x[3].length;b++)if(a.householdId==x[3][b].Id){if(null!==x[3][b].npo02__HouseholdPhone__c)return x[3][b].npo02__HouseholdPhone__c;break}for(var c=0;c<x[1].length;c++)if(a.Primary_Contact__c==x[1][c].Id){if(null!==x[1][c].Phone)return x[1][c].Phone;break}}else{for(var d=0;d<x[2].length;d++)if(a.AccountId==x[2][d].Id){if(null!==x[2][d].Phone)return x[2][d].Phone;break}for(var e=0;e<x[1].length;e++)if(a.Primary_Contact__c==x[1][e].Id)return null!==x[1][e].Phone?x[1][e].Phone:"No phone number found"}return"No phone number found"}function r(a){for(var b=0;b<x[2].length;b++){var c={};if(a.AccountId==x[2][b].Id&&null!=x[2][b].BillingAddress)return c.lifeTimeAmount=x[2][b].npe01__LifetimeDonationHistory_Amount__c,c.lifeTimeNumber=x[2][b].npe01__LifetimeDonationHistory_Number__c,c}return"No donation history found"}function s(a){for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id){var c=x[1][b].Name.split(" ");return c[0]}}function t(a){for(var b=0;b<x[1].length;b++)if(a.Primary_Contact__c==x[1][b].Id){var c=x[1][b].Name.split(" ");return c[1]}}function u(){a.get("/template/getTemplates").then(v,w)}function v(a){console.log("templates",a),C=a.data,console.log(C),A.template1=C[0],A.template2=C[1],A.template3=C[2],A.template4=C[3],A.template5=C[4],b.path("/home")}function w(a){console.log("template retrieval failure")}var x=[],y=[],z={},A={},B={donors:[{AccountId:"001d000000K2KKAAA3",Amount:200,CloseDate:"2016-08-22",Id:"006d000000r6cKWAAY",Name:"Test",Primary_Contact__c:"003d000000V8J9gAAF",address:{city:"Monrovia",country:"Liberia",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:null,state:null,stateCode:null,street:"N&N Corporation"},date:"08-22-2016",donationHistory:{lifeTimeAmount:635,lifeTimeNumber:2},email:"dosawea@yahoo.com",firstName:"Christian",formalGreeting:"Christian Neufville",householdId:"a00d0000007j6fAAAQ",informalGreeting:"Christian",lastName:"Neufville",npe01__Contact_Id_for_Role__c:"003d000000V8J9gAAF",npe01__Is_Opp_From_Individual__c:"true",personName:"Neufville Household",phone:"No phone number found"},{AccountId:"001d0000025MIlJAAW",Amount:300,CloseDate:"2016-08-22",Id:"006d000000r6efMAAQ",Name:"Trent Test 8/22/16",Primary_Contact__c:"003d0000037X5z3AAC",address:{city:"Notreal",country:"US",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:"55444",state:"MT",stateCode:null,street:"123 fake st."},date:"08-22-2016",donationHistory:{lifeTimeAmount:1100,lifeTimeNumber:2},email:"trent@fake.net",firstName:"Trent",formalGreeting:"Mr. Trent Johnson",householdId:"a00d000000mOdmgAAC",informalGreeting:"Trent",lastName:"Johnson",npe01__Contact_Id_for_Role__c:"003d0000037X5z3AAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Johnson Household",phone:"(555) 555-3333"},{AccountId:"001d0000025MImRAAW",Amount:1234,CloseDate:"2016-08-22",Id:"006d000000r6ehSAAQ",Name:"Jonanthon Wilson- Donation 8/22/2016",Primary_Contact__c:"003d0000037X61sAAC",address:{city:"real",country:null,countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:55707,state:"MN",stateCode:null,street:"74382 idk ave"},date:"08-22-2016",donationHistory:{lifeTimeAmount:11110,lifeTimeNumber:2},email:"jon@prime.io",firstName:"Jonanthon",formalGreeting:"Mr. Jonanthon and Mrs. Wife Wilson",householdId:"a00d000000mOdn5AAC",informalGreeting:"Jonanthon and Wife",lastName:"Wilson",npe01__Contact_Id_for_Role__c:"003d0000037X61sAAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Wilson Household",phone:"(651) 444-4444"}]};z.sorted=y;var C=[];return{preconvertDates:g,convertDates:h,sortedObject:z,getData:d,donorObject:B,checkDone:c,templatesObject:A,getTemplates:u}}]),angular.module("App").controller("LoginController",["$http","$location","RouteService","DataService",function(a,b,c,d){function e(a){console.log("Success",a),b.path("/home")}function f(a){console.log("Failure",a),b.path("/"),g.error=!0}var g=this;g.homeRoute=function(){c.homeRoute()},g.editRoute=function(){c.editRoute()},g.settingsRoute=function(){c.settingsRoute()},g.username="",g.password="",g.error=!1,g.errorMessage="Sorry, Wrong Username/Password",g.login=function(){console.log("Username",g.username),console.log("Password",g.password);var b={};b.username=g.username,b.password=g.password,a.post("/login",b).then(e,f)}}]),angular.module("App").controller("GettingDataController",["DataService",function(a){a.getTemplates()}]),angular.module("App").controller("HomeController",["$http","$location","DataService","RouteService","orderByFilter","$uibModal","TemplateService","EmailService",function(a,b,c,d,e,f,g,h){function i(a){console.log("Im getting the current template"),g.getCurrentTemplate(a)}var j=this;j.donorList=c.donorObject.donors,console.log("donor list",j.donorList),j.homeRoute=function(){d.homeRoute()},j.editRoute=function(){d.editRoute()},j.settingsRoute=function(){d.settingsRoute()},j.propertyName="Amount",j.reverse=!0,j.donors=j.donorList,j.dropDownName="Donation",j.sortBy=function(a){switch(console.log("donorList:",j.donors),console.log("sortBy propertyName:",a),j.reverse=j.propertyName===a&&!j.reverse,j.propertyName=a,a){case"lastName":j.dropDownName="Name";break;case"Amount":j.dropDownName="Donation";break;case"date":j.dropDownName="Date"}},j.templatesObject=g.templatesObject,j.currentTemplate=g.currentTemplate,j.savedEmails=g.savedEmails,j.imagesArray=g.imagesObject.images,j.fieldId="",j.currentDonor={},j.setCurrentEditView=function(a){for(var b,c,d=0;d<j.donorList.length;d++)j.donorList[d].Id==a&&(b=j.donorList[d],c=d);j.currentDonor=b},j.editObject={},j.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"},{name:"Template 4",url:"emails/template4EditView.html"},{name:"Template 5",url:"emails/template5EditView.html"}],j.template=j.templates[0],j.editModal=function(a){console.log("currentTemplate:",j.currentTemplate),j.fieldId=a,j.currentTemplate.currentField=a,f.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},j.imageModal=function(a){f.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},j.sendMail=function(a,b,c,d,e,f,g){console.log("You cliked me"),h.sendMail(a,b,c,d,e,f,g)},j.saveEditedEmail=function(a,b,c,d,e,f){g.saveEditedEmail(a,b,c,d,e,f)},i(1)}]),angular.module("App").controller("EditController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){function g(a){console.log("Im getting the current template"),e.getCurrentTemplate(a)}var h=this;h.templatesObject=e.templatesObject,h.currentTemplate=e.currentTemplate,h.savedEmails=e.savedEmails,h.imagesArray=e.imagesObject.images,h.fieldId="",h.editObject={},h.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"}],h.template=h.templates[0],h.editModal=function(a){console.log("currentTemplate:",h.currentTemplate),h.fieldId=a,h.currentTemplate.currentField=a,c.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.imageModal=function(a){c.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.sendMail=function(a,b,c){console.log("You cliked me"),f.sendMail(a,b,c)},h.saveEditedEmail=function(a,b,c,d,f,g){e.saveEditedEmail(a,b,c,d,f,g)},g(1)}]),angular.module("App").controller("SettingsController",["$http","$location","DataService","Upload","$timeout",function(a,b,c,d,e){function f(){a.get("/createphotoarray").then(g)}function g(a){console.log(a.data),h.photos=a.data}var h=this;h.unhidePhotos=!1,h.photos=[],f(),h.uploadPic=function(a){a.upload=d.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(h.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},h.uploadSig=function(a){a.upload=d.upload({url:"/photos/sigfile",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(h.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},h.uploadHeader=function(a){a.upload=d.upload({url:"/photos/headers",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(h.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},h.showPhotos=function(){h.unhidePhotos=!0}}]),angular.module("App").factory("RouteService",["$location",function(a){function b(){a.path("/")}function c(){a.path("/home")}function d(){a.path("/edit")}function e(){a.path("/settings")}return{loginRoute:b,homeRoute:c,editRoute:d,settingsRoute:e}}]),angular.module("App").factory("EmailService",["$http","$location",function(a,b){function c(c,d,e,f,g,h,i){var j={};j.p1=c,j.p2=d,j.p3=e,j.p4=f,j.q=g,j.ps=h,j.donor=i,console.log("sendData = ",j),a.post("/email/sendMail",j).then(function(a){console.log("Button Pressed"),console.log("send email",a)}),b.path("/")}return{sendMail:c}}]),angular.module("App").factory("TemplateService",["$location","Upload","$timeout","$http","DataService",function(a,b,c,d,e){function f(a){var b=a;d.post("/template/saveTemplate",b).then(g,h)}function g(a){console.log("temp save success",a)}function h(a){console.log("save temp failure",a)}function i(){p.template1.img4="",f(p.template1)}function j(a){"assets/addPictureIcon.png"==a?console.log(a):o.img=a}function k(){d.get("/photos").success(function(a){console.log("response from get photos",a)})}function l(a){console.log(a),a.upload=b.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){c(function(){a.result=b.data,newImage=a.result,console.log("This is the file.result",a.result),r.images.push(newImage)})},function(a){a.status>0&&(vm.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))}),k()}function m(a){o.p1=p["template"+a].p1,o.p2=p["template"+a].p2,o.p3=p["template"+a].p3,o.p4=p["template"+a].p4,o.q=p["template"+a].quote,o.ps=p["template"+a].ps,o.img=p["template"+a].img}function n(a,b,c,d,e,f){q.emails.push({p1:a,p2:b,p3:c,p4:d,q:e,ps:f})}var o={p1:"",p2:"",p3:"",p4:"",q:"",ps:"",currentEdit:"",img:""},p=e.templatesObject;i();var q={emails:[]},r={images:["assets/sampleimage.jpg","assets/sampleimage2.jpg","assets/sampleimage3.jpg","assets/sampleimage4.jpg","assets/sampleimage5.jpg","assets/sampleimage0.jpg","assets/sampleimage20.jpg","assets/sampleimage30.jpg","assets/sampleimage40.jpg","assets/sampleimage50.jpg"]};return{currentTemplate:o,getCurrentTemplate:m,imagesObject:r,saveEditedEmail:n,savedEmails:q,setCurrentImg:j,templatesObject:p,uploadPic:l}}]),angular.module("App").controller("ModalController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){var g=this;g.currentTemplate=e.currentTemplate,g.imagesArray=e.imagesObject.images,g.setCurrentImg=function(a){e.setCurrentImg(a)},g.uploadPic=function(a){console.log("Uploading Pic",a),e.uploadPic(a)}}]),angular.module("App").factory("DonationService",["$http","$location",function(a,b,c){function d(){return a.get("/donor/sentDonors").then(function(a){console.log("donors",a.data);var b={};b.donors=a.data,e(b)},function(a){console.log("err",a),response.sendStatus(500)})}function e(c){return a.post("/salesforce/overview",c).then(function(a){console.log("success getting donor stuff from db",a),b.path("/overview")},function(a){console.log("faiiiiiiiiiiiiilure",a),response.sendStatus(500)})}function f(b){return a.post("/donor/createData",b).then(function(a){console.log("save to db success",a),a.sendStatus(200)},function(a){console.log("fail saving to db",a),response.sendStatus(500)})}return{getDonorDbStuff:d,getDonorsSentEmailData:e,saveToDb:f}}]);