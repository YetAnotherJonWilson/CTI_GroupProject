angular.module("App",["ngRoute","ngAnimate","ui.bootstrap","ngFileUpload"]),angular.module("App").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"login"}).when("/home",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home"}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"settings"}).when("/gettingdata",{templateUrl:"/views/gettingdata.html",controller:"GettingDataController",controllerAs:"getting"}).when("/donor",{templateUrl:"/views/donor.html",controller:"MainController",controllerAs:"main"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("App").controller("MainController",["$http","$location","DataService",function(a,b,c){var d=this;d.message="CTI Thank You Email System",d.sendMail=function(){EmailService.sendMail()},d.saveTest=function(){var b={};b.opportunityId="",b.contactId="",b.accountId="",b.closeDate="",b.sentDate="",b.householdId="",b.paragraph1="",b.paragraph2="",b.paragraph3="",b.paragraph4="",b.paragraph5="",b.quote="",b.picture1="",b.picture2="",b.picture3="",b.picture4="",b.letterhead="",b.signature="",console.log("test button"),a.post("/donor/createData",b).then(function(a){console.log("test success",a)},function(a){console.log("test fail",a)})}}]),angular.module("App").factory("DataService",["$http","$location",function(a,b){function c(){a.get("/salesforce/done").then(d,g)}function d(a){b.path("/home")}function e(){a.get("/salesforce/data").then(f,g)}function f(a){console.log(a),v=a.data,v[0].length===v[3].length?(j(v),h(),i()):e()}function g(a){console.log("fail",a)}function h(){for(var a=0;a<x.sorted.length;a++){var b=x.sorted[a].CloseDate.split("-");x.sorted[a].date=b[1]+"-"+b[2]+"-"+b[0]}}function i(){for(var a=0;a<x.sorted.length;a++)x.sorted[a].convertedDate=new Date(x.sorted[a].date)}function j(a){for(var b=0;b<a[0].length;b++)w.push(a[0][b]);k(),l()}function k(){for(var a=0;a<w.length;a++)for(var b=0;b<v[1].length;b++)if(w[a].Primary_Contact__c==v[1][b].Id){w[a].householdId=v[1][b].npo02__Household__c;break}}function l(){for(var a=0;a<w.length;a++)w[a].email=m(w[a]),w[a].address=n(w[a]),w[a].formalGreeting=o(w[a]),w[a].informalGreeting=p(w[a]),w[a].personName=q(w[a]),w[a].phone=r(w[a]),w[a].donationHistory=s(w[a]),w[a].firstName=t(w[a]),w[a].lastName=u(w[a]);console.log(w)}function m(a){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__HouseholdEmail__c)return v[3][b].npo02__HouseholdEmail__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Email)return v[1][b].Email;for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Organization_Email__c)return v[2][b].Organization_Email__c;return"no email found"}function n(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].MailingAddress)return v[1][b].MailingAddress;for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Formula_MailingAddress__c)return v[3][b].npo02__Formula_MailingAddress__c}else for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].BillingAddress)return v[2][b].BillingAddress;return"no address found"}function o(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Formal_Greeting__c)return v[3][b].npo02__Formal_Greeting__c;for(var b=0;b<v[1].length;b++){if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].name&&null!=v[1][b].Saluation)return v[1][b].Saluation+v[1][b].Name;if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].name)return v[1][b].Name}}else{for(var b=0;b<v[1].length;b++){if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Name&&null!=v[1][b].Saluation)return v[1][b].Saluation+v[1][b].Name;if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Name)return v[1][b].Name}for(var b=0;b<v[2].length;b++){if(a.AccountId==v[2][b].Id&&null!=v[2][b].Name&&null!=v[2][b].Formal_Salutation__c)return v[2][b].Formal_Salutation__c+v[2][b].Name;if(a.AccountId==v[2][b].Id&&null!=v[2][b].Name)return v[2][b].Name}}return"no Formal Greeting found"}function p(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Informal_Greeting__c)return v[3][b].npo02__Informal_Greeting__c;for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Informal_Greeting__c)return v[2][b].Informal_Greeting__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][1].Greeting__c)return v[2][b].Greeting__c}else{for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Informal_Greeting__c)return v[2][b].Informal_Greeting__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Greeting__c)return v[1][b].Greeting__c}return"no informal Greeting found"}function q(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id)return v[3][b].Name;for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id)return v[1][c].Name}else{for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id)return v[1][c].Name;for(var d=0;d<v[2].length;d++)if(a.AccountId==v[2][d].Id)return v[2][d].Name}return"No Name Found"}function r(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id){if(null!==v[3][b].npo02__HouseholdPhone__c)return v[3][b].npo02__HouseholdPhone__c;break}for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id){if(null!==v[1][c].Phone)return v[1][c].Phone;break}}else{for(var d=0;d<v[2].length;d++)if(a.AccountId==v[2][d].Id){if(null!==v[2][d].Phone)return v[2][d].Phone;break}for(var e=0;e<v[1].length;e++)if(a.Primary_Contact__c==v[1][e].Id)return null!==v[1][e].Phone?v[1][e].Phone:"No phone number found"}return"No phone number found"}function s(a){for(var b=0;b<v[2].length;b++){var c={};if(a.AccountId==v[2][b].Id&&null!=v[2][b].BillingAddress)return c.lifeTimeAmount=v[2][b].npe01__LifetimeDonationHistory_Amount__c,c.lifeTimeNumber=v[2][b].npe01__LifetimeDonationHistory_Number__c,c}return"No donation history found"}function t(a){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id){var c=v[1][b].Name.split(" ");return c[0]}}function u(a){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id){var c=v[1][b].Name.split(" ");return c[1]}}var v=[],w=[],x={},y={donors:[{firstName:"Jimmy",lastName:"Jam",email:"jimmyj@gmail.com",donationAmount:5e3,donationDate:"8/6/2017",street:"Detroit Ave",city:"Detroit",state:"Michigan",zip:87657},{firstName:"Michael",lastName:"Jackson",email:"immichael@hotmail.com",donationAmount:6e4,donationDate:"5/23/2017",street:"Neverland Way",city:"Los Angeles",state:"California",zip:90280},{firstName:"Phil",lastName:"Mickelson",email:"lefty@yahoo.com",donationAmount:9e3,donationDate:"7/6/2017",street:"Orlando Way",city:"Orlando",state:"Florida",zip:34089},{firstName:"Michael",lastName:"Jordan",email:"hisairness@gmail.com",donationAmount:5e4,donationDate:"5/20/2014",street:"Dunk St.",city:"Chicago",state:"IL",zip:55612},{firstName:"Michael",lastName:"Phelps",email:"phelpswim@gmail.com",donationAmount:4e4,donationDate:"6/05/2016",street:"Swim St.",city:"Los Angeles",state:"CA",zip:90212},{firstName:"Steve",lastName:"Jobs",email:"applefan@apple.com",donationAmount:1e5,donationDate:"12/25/2012",street:"Apple Ave.",city:"Silicon Valley",state:"CA",zip:90543},{firstName:"John",lastName:"Wayne",email:"olejonny@gmail.com",donationAmount:19,donationDate:"1/30/1981",street:"Old West St.",city:"Old West Town",state:"MT",zip:65652}]};return x.sorted=w,{preconvertDates:h,convertDates:i,sortedObject:x,getData:e,donorObject:y,checkDone:c}}]),angular.module("App").controller("LoginController",["$http","$location","RouteService","DataService",function(a,b,c,d){function e(a){console.log("Success",a),b.path("/home")}function f(a){console.log("Failure",a),b.path("/"),g.error=!0}var g=this;g.homeRoute=function(){c.homeRoute()},g.editRoute=function(){c.editRoute()},g.settingsRoute=function(){c.settingsRoute()},g.username="",g.password="",g.error=!1,g.errorMessage="Sorry, Wrong Username/Password",g.login=function(){console.log("Username",g.username),console.log("Password",g.password);var b={};b.username=g.username,b.password=g.password,a.post("/login",b).then(e,f)}}]),angular.module("App").controller("GettingDataController",["DataService",function(a){a.checkDone()}]),angular.module("App").controller("HomeController",["$http","$location","DataService","RouteService","orderByFilter","$uibModal","TemplateService","EmailService",function(a,b,c,d,e,f,g,h){function i(a){console.log("Im getting the current template"),g.getCurrentTemplate(a)}c.getData();var j=this;j.donorList=c.sortedObject.sorted,j.homeRoute=function(){d.homeRoute()},j.editRoute=function(){d.editRoute()},j.settingsRoute=function(){d.settingsRoute()},j.propertyName="Amount",j.reverse=!0,j.donors=j.donorList,j.sortBy=function(a){console.log("donorList:",j.donors),console.log("sortBy propertyName:",a),j.reverse=j.propertyName===a&&!j.reverse,j.propertyName=a},j.templatesObject=g.templatesObject,j.currentTemplate=g.currentTemplate,j.savedEmails=g.savedEmails,j.imagesArray=g.imagesObject.images,j.fieldId="",j.editObject={},j.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"}],j.template=j.templates[0],j.editModal=function(a){console.log("currentTemplate:",j.currentTemplate),j.fieldId=a,j.currentTemplate.currentField=a,f.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},j.imageModal=function(a){f.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},j.sendMail=function(a,b,c){console.log("You cliked me"),h.sendMail(a,b,c)},j.saveEditedEmail=function(a,b,c,d,e,f){g.saveEditedEmail(a,b,c,d,e,f)},i(1)}]),angular.module("App").controller("EditController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){function g(a){console.log("Im getting the current template"),e.getCurrentTemplate(a)}var h=this;h.templatesObject=e.templatesObject,h.currentTemplate=e.currentTemplate,h.savedEmails=e.savedEmails,h.imagesArray=e.imagesObject.images,h.fieldId="",h.editObject={},h.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"}],h.template=h.templates[0],h.editModal=function(a){console.log("currentTemplate:",h.currentTemplate),h.fieldId=a,h.currentTemplate.currentField=a,c.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.imageModal=function(a){c.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.sendMail=function(a,b,c){console.log("You cliked me"),f.sendMail(a,b,c)},h.saveEditedEmail=function(a,b,c,d,f,g){e.saveEditedEmail(a,b,c,d,f,g)},g(1)}]),angular.module("App").controller("SettingsController",["$http","$location","DataService","Upload","$timeout",function(a,b,c,d,e){var f=this;f.uploadPic=function(a){a.upload=d.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(f.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},f.uploadSig=function(a){a.upload=d.upload({url:"/sigfile",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(f.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},f.uploadHeader=function(a){a.upload=d.upload({url:"/headers",arrayKey:"",data:{file:a}}),a.upload.then(function(b){e(function(){a.result=b.data})},function(a){a.status>0&&(f.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})}}]),angular.module("App").factory("RouteService",["$location",function(a){function b(){a.path("/")}function c(){a.path("/home")}function d(){a.path("/edit")}function e(){a.path("/settings")}return{loginRoute:b,homeRoute:c,editRoute:d,settingsRoute:e}}]),angular.module("App").factory("EmailService",["$http","$location",function(a,b){function c(c,d,e){var f={};f.p1=c,f.p2=e,f.q=d,console.log("sendData = ",f),a.post("/email/sendMail",f).then(function(a){console.log("Button Pressed"),console.log("send email",a)}),b.path("/")}return{sendMail:c}}]),angular.module("App").factory("TemplateService",["$location",function(a){function b(a){e.img=a}function c(a){e.p1=g["template"+a].p1,e.p2=g["template"+a].p2,e.p3=g["template"+a].p3,e.p4=g["template"+a].p4,e.q=g["template"+a].q,e.ps=g["template"+a].ps,e.img=g["template"+a].img}function d(a,b,c,d,e,g){f.emails.push({p1:a,p2:b,p3:c,p4:d,q:e,ps:g})}var e={p1:"",p2:"",p3:"",p4:"",q:"",ps:"",currentEdit:"",img:""},f={emails:[]},g={template1:{p1:"Thank you for believing in a world without hunger and poverty. And not just believing in such a world, but making it possible. Because of your generosity, communities around the world are gaining safe water and putting more food on the table.",p2:"It's clear that you see the value in helping people help themselves. But I want you to know what a profound impact your gift can have on someone's life. Read what Aissatou Ly, Senegalese farmer and business owner, told us:",p3:"Your gift helps women like Aissatou start businesses, earn an income, and send their kids to school-or go themselves. You make success stories like Aissatou's possible. And I can't thank you enough.",p4:"",q:"Six months ago I bought a CTI grinder. I provide grinding services to other women and grind about 10 kg of peanut butter a day and sell it at the weekly market. I'm proud, as a woman, to be a leader and have respect in my community. I'm proud that I don't need to ask for help.",ps:"P.S. Please get in touch with me if you have any questions about our programs or CTI in general (alexandra@compatibletechnology.org). And thanks again for your generosity and support!",currentField:"",img:"assets/sampleimage3.jpg"},template2:{},template3:{}},h={images:["assets/sampleimage.jpg","assets/sampleimage2.jpg","assets/sampleimage3.jpg","assets/sampleimage4.jpg","assets/sampleimage5.jpg","assets/sampleimage0.jpg","assets/sampleimage20.jpg","assets/sampleimage30.jpg","assets/sampleimage40.jpg","assets/sampleimage50.jpg"]};return{currentTemplate:e,getCurrentTemplate:c,imagesObject:h,saveEditedEmail:d,savedEmails:f,setCurrentImg:b,templatesObject:g}}]),angular.module("App").controller("ModalController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){var g=this;g.currentTemplate=e.currentTemplate,g.imagesArray=e.imagesObject.images,g.setCurrentImg=function(a){e.setCurrentImg(a)}}]);