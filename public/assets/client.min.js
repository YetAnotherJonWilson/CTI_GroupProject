angular.module("App",["ngRoute","ngAnimate","ui.bootstrap","ngFileUpload","angularMoment"]),angular.module("App").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"login"}).when("/home",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home",resolve:{someting:["DataService",function(a){return a.getData()}],stuff:["DataService",function(a){return a.getTemplates()}]}}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"settings",resolve:{getTemplates:["DataService",function(a){return a.getTemplates()}]}}).when("/gettingdata",{templateUrl:"/views/gettingdata.html",controller:"GettingDataController",controllerAs:"getting"}).when("/donor",{templateUrl:"/views/donor.html",controller:"MainController",controllerAs:"main"}).when("/overview",{templateUrl:"/views/overview.html",controller:"OverviewController",controllerAs:"over"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("App").controller("MainController",["$http","$location","DonationService",function(a,b,c){var d=this;d.message="CTI Thank You Email System",d.sendMail=function(){EmailService.sendMail()},d.overiew=function(){c.getDonorDbStuff().then(function(a){console.log("did you work?")},function(a){console.log("worked???")})},d.saveTest=function(){var a={};a.opportunityId="006d000000r6ehSAAQ",a.contactId="003d0000037X61sAAC",a.accountId="001d0000025MImRAAW",a.closeDate="2016-08-22",a.sentDate="",a.householdId="a00d000000mOdn5AAC",a.paragraph1="paragraph 1 bleh bleh belh",a.paragraph2="paragraph 2 test",a.paragraph3="paragraph 3 words",a.paragraph4="paragraph 4 more words",a.paragraph5="paragraph 5, doubt it",a.quote="some witty quote",a.picture1="/path/to/pic1",a.picture2="/path/to/pic2",a.picture3="/path/to/pic3",a.picture4="/path/to/pic4",a.letterhead="/path/to/letterhead",a.signature="/path/to/signature",a.template="./emails/template#OverView",console.log("test button"),c.saveToDb(a).then(function(a){console.log("test save success",a)},function(a){console.log("test save fail",a)})}}]),angular.module("App").factory("DataService",["$http","$location",function(a,b){function c(){return a.get("/salesforce/data").then(d,e)}function d(a){console.log(a),v=a.data,g(v),f(),b.path("/home")}function e(a){console.log("fail",a)}function f(){for(var a=0;a<x.sorted.length;a++){var b=x.sorted[a].CloseDate.split("-");x.sorted[a].date=b[1]+"-"+b[2]+"-"+b[0]}}function g(a){for(var b=0;b<a[0].length;b++)w.push(a[0][b]);h(),i()}function h(){for(var a=0;a<w.length;a++)for(var b=0;b<v[1].length;b++)if(w[a].Primary_Contact__c==v[1][b].Id){w[a].householdId=v[1][b].npo02__Household__c;break}}function i(){for(var a=0;a<w.length;a++)w[a].email=j(w[a]),w[a].address=k(w[a]),w[a].formalGreeting=l(w[a]),w[a].informalGreeting=m(w[a]),w[a].personName=n(w[a]),w[a].phone=o(w[a]),w[a].donationHistory=p(w[a]),w[a].firstName=q(w[a]),w[a].lastName=r(w[a]);console.log(w)}function j(a){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__HouseholdEmail__c)return v[3][b].npo02__HouseholdEmail__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Email)return v[1][b].Email;for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Organization_Email__c)return v[2][b].Organization_Email__c;return"no email found"}function k(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].MailingAddress)return v[1][b].MailingAddress;for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Formula_MailingAddress__c)return v[3][b].npo02__Formula_MailingAddress__c}else for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].BillingAddress)return v[2][b].BillingAddress;return"no address found"}function l(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Formal_Greeting__c)return v[3][b].npo02__Formal_Greeting__c;for(var b=0;b<v[1].length;b++){if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].name&&null!=v[1][b].Saluation)return v[1][b].Saluation+v[1][b].Name;if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].name)return v[1][b].Name}}else{for(var b=0;b<v[1].length;b++){if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Name&&null!=v[1][b].Saluation)return v[1][b].Saluation+v[1][b].Name;if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Name)return v[1][b].Name}for(var b=0;b<v[2].length;b++){if(a.AccountId==v[2][b].Id&&null!=v[2][b].Name&&null!=v[2][b].Formal_Salutation__c)return v[2][b].Formal_Salutation__c+v[2][b].Name;if(a.AccountId==v[2][b].Id&&null!=v[2][b].Name)return v[2][b].Name}}return"no Formal Greeting found"}function m(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id&&null!=v[3][b].npo02__Informal_Greeting__c)return v[3][b].npo02__Informal_Greeting__c;for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Informal_Greeting__c)return v[2][b].Informal_Greeting__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][1].Greeting__c)return v[2][b].Greeting__c}else{for(var b=0;b<v[2].length;b++)if(a.AccountId==v[2][b].Id&&null!=v[2][b].Informal_Greeting__c)return v[2][b].Informal_Greeting__c;for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id&&null!=v[1][b].Greeting__c)return v[1][b].Greeting__c}return"no informal Greeting found"}function n(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id)return v[3][b].Name;for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id)return v[1][c].Name}else{for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id)return v[1][c].Name;for(var d=0;d<v[2].length;d++)if(a.AccountId==v[2][d].Id)return v[2][d].Name}return"No Name Found"}function o(a){if("true"===a.npe01__Is_Opp_From_Individual__c){for(var b=0;b<v[3].length;b++)if(a.householdId==v[3][b].Id){if(null!==v[3][b].npo02__HouseholdPhone__c)return v[3][b].npo02__HouseholdPhone__c;break}for(var c=0;c<v[1].length;c++)if(a.Primary_Contact__c==v[1][c].Id){if(null!==v[1][c].Phone)return v[1][c].Phone;break}}else{for(var d=0;d<v[2].length;d++)if(a.AccountId==v[2][d].Id){if(null!==v[2][d].Phone)return v[2][d].Phone;break}for(var e=0;e<v[1].length;e++)if(a.Primary_Contact__c==v[1][e].Id)return null!==v[1][e].Phone?v[1][e].Phone:"No phone number found"}return"No phone number found"}function p(a){for(var b=0;b<v[2].length;b++){var c={};if(a.AccountId==v[2][b].Id&&null!=v[2][b].BillingAddress)return c.lifeTimeAmount=v[2][b].npe01__LifetimeDonationHistory_Amount__c,c.lifeTimeNumber=v[2][b].npe01__LifetimeDonationHistory_Number__c,c}return"No donation history found"}function q(a){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id){var c=v[1][b].Name.split(" ");return c[0]}}function r(a){for(var b=0;b<v[1].length;b++)if(a.Primary_Contact__c==v[1][b].Id){var c=v[1][b].Name.split(" ");return c[1]}}function s(){return a.get("/template/getTemplates").then(t,u)}function t(a){console.log("templates",a),A=a.data,console.log(A),y.template1=A[0],y.template2=A[1],y.template3=A[2],y.template4=A[3],y.template5=A[4]}function u(a){console.log("template retrieval failure")}var v=[],w=[],x={},y={},z={donors:[{AccountId:"001d000000K2KKAAA3",Amount:200,CloseDate:"2016-08-22",Id:"006d000000r6cKWAAY",Name:"Test",Primary_Contact__c:"003d000000V8J9gAAF",address:{city:"Monrovia",country:"Liberia",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:null,state:null,stateCode:null,street:"N&N Corporation"},date:"08-22-2016",donationHistory:{lifeTimeAmount:635,lifeTimeNumber:2},email:"ctithankyou@outlook.com",firstName:"Christian",formalGreeting:"Christian Neufville",householdId:"a00d0000007j6fAAAQ",informalGreeting:"Christian",lastName:"Neufville",npe01__Contact_Id_for_Role__c:"003d000000V8J9gAAF",npe01__Is_Opp_From_Individual__c:"true",personName:"Neufville Household",phone:"No phone number found"},{AccountId:"001d0000025MIlJAAW",Amount:300,CloseDate:"2016-08-22",Id:"006d000000r6efMAAQ",Name:"Trent Test 8/22/16",Primary_Contact__c:"003d0000037X5z3AAC",address:{city:"Notreal",country:"US",countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:"55444",state:"MT",stateCode:null,street:"123 fake st."},date:"08-22-2016",donationHistory:{lifeTimeAmount:1100,lifeTimeNumber:8},email:"tdjohnson0722@gmail.com",firstName:"Trent",formalGreeting:"Mr. Trent Johnson",householdId:"a00d000000mOdmgAAC",informalGreeting:"Trent",lastName:"Johnson",npe01__Contact_Id_for_Role__c:"003d0000037X5z3AAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Johnson Household",phone:"(555) 555-3333"},{AccountId:"001d0000025MImRAAW",Amount:1234,CloseDate:"2016-08-22",Id:"006d000000r6ehSAAQ",Name:"Jonathon Wilson- Donation 8/22/2016",Primary_Contact__c:"003d0000037X61sAAC",address:{city:"real",country:null,countryCode:null,geocodeAccuracy:null,latitude:null,longitude:null,postalCode:55707,state:"MN",stateCode:null,street:"74382 idk ave"},date:"08-22-2016",donationHistory:{lifeTimeAmount:11110,lifeTimeNumber:2},email:"ctithankyou@outlook.com",firstName:"Jonathan",formalGreeting:"Mr. Jonathan and Mrs. Wife Wilson",householdId:"a00d000000mOdn5AAC",informalGreeting:"Jonathan and Wife",lastName:"Wilson",npe01__Contact_Id_for_Role__c:"003d0000037X61sAAC",npe01__Is_Opp_From_Individual__c:"true",personName:"Wilson Household",phone:"(651) 444-4444"}]};x.sorted=w;var A=[];return{preconvertDates:f,sortedObject:x,getData:c,donorObject:z,templatesObject:y,getTemplates:s}}]),angular.module("App").controller("LoginController",["$http","$location","RouteService","DataService",function(a,b,c,d){function e(a){console.log("Success",a),b.path("/home")}function f(a){console.log("Failure",a),b.path("/"),g.error=!0}var g=this;g.homeRoute=function(){c.homeRoute()},g.editRoute=function(){c.editRoute()},g.settingsRoute=function(){c.settingsRoute()},g.username="",g.password="",g.error=!1,g.errorMessage="Sorry, Wrong Username/Password",g.login=function(){console.log("Username",g.username),console.log("Password",g.password);var b={};b.username=g.username,b.password=g.password,a.post("/login",b).then(e,f)}}]),angular.module("App").controller("GettingDataController",["DataService",function(a){a.getData(),a.getTemplates()}]),angular.module("App").controller("HomeController",["$http","$location","DataService","RouteService","orderByFilter","$uibModal","TemplateService","EmailService","UserService","$route","DonationService",function(a,b,c,d,e,f,g,h,i,j,k){function l(){for(var a=c.templatesObject["template"+r.standardTemplate],b=c.donorObject.donors,d=0;d<b.length;d++)b[d].template=Object.assign({},a);r.donorList=b,console.log("donorList after build:",r.donorList),console.log("DataService.templatesObject:",c.templatesObject)}function m(a){r.selectedTemplate=r.templates[a-1]}function n(){r.currentDonor=g.currentDonor.donor[0].donor}function o(a){g.updateCurrentDonor(a)}function p(a){console.log("template name:",a);var b=a.split(" "),c=b[1];g.updateCurrentDonorTemplate(c)}function q(a){var b=r.donorList.indexOf(a);r.donorList.splice(b,1),r.currentDonor=void 0,r.messageSent=!0}var r=this;r.donorList=[],r.currentDonor,r.editedDonorsArray=[],r.editedEmails={},r.messageSent=!1,r.standardTemplate=i.standardTemplate.template,r.homeRoute=function(){d.homeRoute()},r.editRoute=function(){d.editRoute()},r.settingsRoute=function(){d.settingsRoute()},r.templatesObject=g.templatesObject,r.currentTemplate=g.currentTemplate,r.savedEmails=g.savedEmails,r.imagesArray=g.imagesObject.images,r.fieldId="",r.setCurrentEditView=function(a){console.log("selectedTemplate:",r.selectedTemplate);var b,c;if(r.currentDonor){p(r.selectedTemplate.name);for(var d=0;d<r.donorList.length;d++)r.donorList[d].Id==r.currentDonor.Id&&(b=d);r.donorList[b]=r.currentDonor}for(var d=0;d<r.donorList.length;d++)r.donorList[d].Id==a&&(c=r.donorList[d]);o(c),n(),m(r.currentDonor.template.temp)},r.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"},{name:"Template 4",url:"emails/template4EditView.html"},{name:"Template 5",url:"emails/template5EditView.html"}],r.selectedTemplate=r.templates[0],r.updateTemplateNum=function(){console.log("You clicked the template")},r.editModal=function(a){console.log("currentTemplate:",r.currentTemplate),r.fieldId=a,r.currentDonor.template.currentField=a,f.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},r.imageModal=function(a){r.currentDonor.template.currentField=a,f.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md",windowClass:"imageModalClass"})},r.propertyName="Amount",r.reverse=!0,r.donors=r.donorList,r.dropDownName="Donation",r.sortBy=function(a){switch(console.log("donorList:",r.donors),console.log("sortBy propertyName:",a),r.reverse=r.propertyName===a&&!r.reverse,r.propertyName=a,a){case"lastName":r.dropDownName="Name";break;case"Amount":r.dropDownName="Donation";break;case"date":r.dropDownName="Date"}},r.saveEditedEmail=function(a,b,c,d,e,f,g,h,i,j){r.editedEmails.p1=a,r.editedEmails.p2=b,r.editedEmails.p3=c,r.editedEmails.p4=d,r.editedEmails.ps=f,r.editedEmails.img=g,r.editedEmails.img2=h,r.editedEmails.img3=i,r.editedEmails.img4=j},r.sendMail=function(a){console.log("You cliked me"),p(r.selectedTemplate.name);r.currentDonor.template.temp;h.sendMail(a),k.saveEmail(a),q(a)},r.sendAll=function(){swal({title:"Are you sure?",text:"Do You Want to Send Messages With current formats?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Send Messages",closeOnConfirm:!1},function(){for(var a=0;a<r.donorList.length;a++)h.sendMail(r.donorList[a]),k.saveEmail(r.donorList[a]),r.messageSent=!0;r.currentDonor=void 0,r.donorList=[],swal("Sent!","Your Messages Have Been Sent","success")})},l()}]),angular.module("App").controller("EditController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){function g(a){console.log("Im getting the current template"),e.getCurrentTemplate(a)}var h=this;h.templatesObject=e.templatesObject,h.currentTemplate=e.currentTemplate,h.savedEmails=e.savedEmails,h.imagesArray=e.imagesObject.images,h.fieldId="",h.editObject={},h.templates=[{name:"Template 1",url:"emails/template1EditView.html"},{name:"Template 2",url:"emails/template2EditView.html"},{name:"Template 3",url:"emails/template3EditView.html"}],h.template=h.templates[0],h.editModal=function(a){console.log("currentTemplate:",h.currentTemplate),h.fieldId=a,h.currentTemplate.currentField=a,c.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.imageModal=function(a){c.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},h.sendMail=function(a,b,c){console.log("You cliked me"),f.sendMail(a,b,c)},h.saveEditedEmail=function(a,b,c,d,f,g){e.saveEditedEmail(a,b,c,d,f,g)},g(1)}]),angular.module("App").controller("SettingsController",["$http","$location","DataService","UserService","Upload","$timeout","$uibModal",function(a,b,c,d,e,f,g){function h(a){console.log("Photo Deleted",a),j()}function i(a){console.log("Failed to delete",a)}function j(){a.get("photos/createphotoarray").then(k)}function k(a){console.log(a.data),q.photos=a.data}function l(){a.get("photos/createsignaturearray").then(m)}function m(a){console.log("What is this!!!!!!!!!",a.data),q.signatures=a.data}function n(){a.get("photos/createheaderarray").then(o)}function o(a){console.log(a.data),q.headers=a.data}function p(){var a=c.templatesObject;q.templatesList=Object.assign({},a)}var q=this;q.unhidePhotos=!1,q.unhideSignatures=!1,q.unhideHeaders=!1,q.deletePhoto=function(b){deletePhoto={},id=12345,console.log("photo.id",b.id),deletePhoto.id=b.id,a.post("/photos/deletePhoto",deletePhoto).then(h,i)},j(),l(),n(),q.photos=d.photosArray,q.signatures=d.signaturesArray,q.headers=d.headersArray,q.uploadPic=function(a){a.upload=e.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data,j()})},function(a){a.status>0&&(q.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},q.uploadSig=function(a){a.upload=e.upload({url:"/photos/sigfile",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data})},function(a){a.status>0&&(q.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},q.uploadHeader=function(a){a.upload=e.upload({url:"/photos/headers",arrayKey:"",data:{file:a}}),a.upload.then(function(b){f(function(){a.result=b.data})},function(a){a.status>0&&(q.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})},q.showPhotos=function(){q.unhidePhotos=!q.unhidePhotos},q.showSignatures=function(){q.unhideSignatures=!q.unhideSignatures},q.showHeaders=function(){q.unhideHeaders=!q.unhideHeaders},q.templatesList,q.currentTemplate=1,q.editModal=function(a){console.log("templatesList:",q.templatesList),q.fieldId=a,g.open({animation:!0,ariaLabelledBy:"edit text modal",ariaDescribedBy:"edit text",templateUrl:"emails/edit_modal.html",controller:"ModalController",controllerAs:"modal",size:"md"})},q.imageModal=function(a){g.open({animation:!0,ariaLabelledBy:"image modal",ariaDescribedBy:"pick an image",templateUrl:"emails/image_modal.html",controller:"ModalController",controllerAs:"modal",size:"md",windowClass:"imageModalClass"})},q.templates=[{name:"Template 1",url:"emails/template1SettingsView.html"},{name:"Template 2",url:"emails/template2SettingsView.html"},{name:"Template 3",url:"emails/template3SettingsView.html"},{name:"Template 4",url:"emails/template4SettingsView.html"},{name:"Template 5",url:"emails/template5SettingsView.html"}],q.selectedTemplate=q.templates[0],p()}]),angular.module("App").factory("RouteService",["$location",function(a){function b(){a.path("/")}function c(){a.path("/home")}function d(){a.path("/edit")}function e(){a.path("/settings")}return{loginRoute:b,homeRoute:c,editRoute:d,settingsRoute:e}}]),angular.module("App").factory("EmailService",["$http","$location",function(a,b){function c(c){var d={};d.p1=c.template.p1,d.p2=c.template.p2,d.p3=c.template.p3,d.p4=c.template.p4,d.q=c.template.quote,d.ps=c.template.ps,d.img=c.template.img,d.img2=c.template.img2,d.img3=c.template.img3,d.img4=c.template.img4,d.template=c.template.temp,d.senderName=c.template.senderName,d.senderTitle=c.template.senderTitle,d.email=c.email,d.firstName=c.firstName,d.amount=c.Amount,d.date=c.date,console.log("sendData = ",d),a.post("/email/sendMail",d).then(function(a){console.log("Button Pressed"),console.log("send email",a)}),b.path("/home")}return{sendMail:c}}]),angular.module("App").factory("TemplateService",["$location","Upload","$timeout","$http","DataService",function(a,b,c,d,e){function f(a){p.donor[0].donor.img=a}function g(a,b){p.donor[0].donor.template[a]=b,console.log("TemplateService updateCurrentDonorKey, currentDonor:",p.donor[0])}function h(a){p.donor[0].donor.template.temp=a}function i(a){console.log("update current donor, donor:",a),p.donor[0].donor=a,console.log("Template current donor:",p.donor[0].donor)}function j(){d.get("photos/createphotoarray").then(k)}function k(a){console.log("response.data",a.data),s.images=a.data}function l(a){a.upload=b.upload({url:"/photos",arrayKey:"",data:{file:a}}),a.upload.then(function(b){c(function(){a.result=b.data,j()})},function(a){a.status>0&&(o.errorMsg=a.status+": "+a.data)},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})}function m(a,b,c,d,e,f){r.emails.push({p1:a,p2:b,p3:c,p4:d,quote:e,ps:f})}var n={p1:"",p2:"",p3:"",p4:"",quote:"",ps:"",currentField:"",img:""},o=this,p={donor:[{donor:{}}]},q=e.templatesObject,r={emails:[]},s={images:[]};return j(),{currentDonor:p,currentTemplate:n,imagesObject:s,saveEditedEmail:m,savedEmails:r,setCurrentImg:f,templatesObject:q,uploadPic:l,createPhotoArray:j,updateCurrentDonor:i,updateCurrentDonorKey:g,updateCurrentDonorTemplate:h}}]),angular.module("App").controller("ModalController",["$http","$location","$uibModal","DataService","TemplateService","EmailService",function(a,b,c,d,e,f){var g=this;g.currentDonor=e.currentDonor.donor[0],g.currentField=e.currentDonor.donor[0].donor.template.currentField,g.currentTemplate=e.currentTemplate,g.imagesArray=e.imagesObject.images,g.updateCurrentDonorKey=function(a,b){console.log("modal.currentDonor:",g.currentDonor),console.log("modal TemplateService.currentDonor:",e.currentDonor),e.updateCurrentDonorKey(a,b)}}]),angular.module("App").factory("DonationService",["$http","$location",function(a,b){function c(){return a.get("/donor/sentDonors").then(function(a){console.log("db donors",a.data),p.donors=a.data,d(p)},function(a){console.log("err",a),response.sendStatus(500)})}function d(c){return a.post("/salesforce/overview",c).then(function(a){console.log("success getting donor stuff from db and sf",a),o=a.data,g(o),console.log("overview sorted",q),b.path("/overview")},function(a){console.log("faiiiiiiiiiiiiilure",a),response.sendStatus(500)})}function e(a){var b={};return b.opportunityId=a.Id,b.contactId=a.Primary_Contact__c,b.accountId=a.AccountId,b.closeDate=a.CloseDate,b.sentDate="",b.householdId=a.householdId,b.paragraph1=a.template.p1,b.paragraph2=a.template.p2,b.paragraph3=a.template.p3,b.paragraph4=a.template.p4,b.paragraph5="",b.quote=a.template.quote,b.picture1=a.template.img,b.picture2=a.template.img2,b.picture3=a.template.img3,b.picture4=a.template.img4,b.letterhead="/path/to/letterhead",b.signature="/path/to/signature",b.template=a.template.temp,console.log("test button"),f(b).then(function(a){console.log("test save success",a)},function(a){console.log("test save fail",a)})}function f(b){return a.post("/donor/createData",b).then(function(a){console.log("save to db success",a)},function(a){console.log("fail saving to db",a)})}function g(a){for(var b=0;b<a.length;b++)q.push(a[b]),q[b].Email=h(q[b],a[b]),q[b].personName=i(q[b],a[b]),q[b].AverageAmount=j(q[b],a[b]),q[b].TotalAmount=k(q[b],a[b]),q[b].TotalNumber=l(q[b],a[b]),q[b].FirstName=m(q[b],a[b]),q[b].LastName=n(q[b],a[b]);return q}function h(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__Household__r.npo02__HouseholdEmail__c)return b.Contact.npo02__Household__r.npo02__HouseholdEmail__c;if(null!=b.Contact.Email)return b.Contact.Email}else{if(null!=b.Contact.Email)return b.Contact.Email;if(null!=donors.Account.Organization_Email__c)return b.Account.Organization_Email__c}return"No Email Found"}function i(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__Household__r.Name)return b.Contact.npo02__Household__r.Name;if(null!=b.Contact.Name)return b.Contact.Name}else{if("true"!=b.npe01__Is_Opp_From_Individual__c||null!=b.Account.Name||null!=b.Contact.Name)return b.Contact.Name+" - "+b.Account.Name;if(null!=b.Contact.Name)return b.Contact.Name;if(null!=b.Account.Name)return b.Account.Name}return"No Name Found"}function j(a,b){if("true"==b.npe01__Is_Opp_From_Individual__c){if(null!=b.Contact.npo02__AverageAmount__c)return b.Contact.npo02__AverageAmount__c}else{if(null!=b.Account.npo02__AverageAmount__c)return b.Account.npo02__AverageAmount__c;if(null!=b.Contact.npo02__AverageAmount__c)return b.Contact.npo02__AverageAmount__c}return"No Average Found"}function k(a,b){return null!=b.Account.npe01__LifetimeDonationHistory_Amount__c?b.Account.npe01__LifetimeDonationHistory_Amount__c:"No Lifetime Total Amount Found"}function l(a,b){return null!=b.Account.npe01__LifetimeDonationHistory_Number__c?b.Account.npe01__LifetimeDonationHistory_Number__c:"No Lifetime Total Number Found"}function m(a,b){if(null!=b.Contact.Name){var c=b.Contact.Name.split(" ");return c[0]}return null!=b.Account.Name?b.Account.Name:"No First Name Found"}function n(a,b){if(null!=b.Contact.Name){var c=b.Contact.Name.split(" ");return c[1]}return null!=b.Account.Name?"(Company)":"No Last Name Found"}var o={},p={},q=[];return{getDonorDbStuff:c,getDonorsSentEmailData:d,saveToDb:f,saveEmail:e}}]),angular.module("App").controller("OverviewController",["$http","$location","DonationService","RouteService","orderByFilter","$uibModal","TemplateService","UserService",function(a,b,c,d,e,f,g,h){var i=this;i.donorList=c.donorObject,i.currentDonor,i.sfDonor=c.overview,i.edit=!0,console.log("db donor list",i.donorList),console.log("sf donor list",i.sfDonor),i.homeRoute=function(){d.homeRoute()},i.editRoute=function(){d.editRoute()},i.settingsRoute=function(){d.settingsRoute()},i.bleh=function(){a.get("/photos/getDbImages").then(function(a){console.log("found db images",a),i.pics=a.data,i.edit=!i.edit,console.log("vm.edit",i.edit)},function(a){console.log("err getting db images",a)})}}]),angular.module("App").factory("UserService",["$http",function(a){var b={},c={},d={},e={template:1};return{photosArray:b,signaturesArray:c,headersArray:d,standardTemplate:e}}]);